"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(e){var t="PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,n=/(^[.\/*]*)([^\\:*?"<>|]+)(\.js$)/g,r=0,o=document.getElementsByTagName("head")[0];function i(e){return"[object Array]"===Object.prototype.toString.call(e)}function a(e,t){return n.test(t)?e+t.replace(n,function(e,t,n,r){return n+r}):new Error("模块名不正确，请输入正确的路径")}function s(e,t){if(e){var n=e.split("/");return n.length>0?"".concat(n.join("/"),"/"):""}if(t){var r=t.split("/");return r.pop(),r.length>0?"".concat(r.join("/"),"/"):""}return""}function u(e,t){if(e)for(var n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}function c(e,t,n,r){e.removeEventListener(n,t,!1)}var l=new(function(){function e(){_classCallCheck(this,e),this.config={baseUrl:"",deps:""},this.name="_@",this.globDeps={},this.depQueue=[],this.depMap={}}return _createClass(e,[{key:"configure",value:function(e){return this.config=_objectSpread({},e),this.config.baseUrl=s(this.config.baseUrl),this.config.deps&&l.require({deps:_toConsumableArray(this.config.deps)}),this.config}},{key:"require",value:function(e){if(e){if("string"==typeof e)return l.globDeps[e]?l.globDeps[e].result:new Error("模块".concat(e,"未加载: 使用requrie([])先加载"));if("string"==typeof e.name||"string"==typeof e.src){var t=e.name||e.src;e=_objectSpread({},e,{name:t,src:t})}if(void 0===e.name)e=_objectSpread({},e,{name:"".concat(l.name).concat(r++)});var n=new f(e);return l.globDeps[e.name]=n,n.init(),n}}},{key:"completeLoad",value:function(e){for(var t,n;this.depQueue.length>0;)null===(t=this.depQueue.shift()).name?(t.name=e,n=!0):t.name===e&&(n=!0),this.depMap[e]&&(t.beDeps=_toConsumableArray(this.depMap[e]),delete this.depMap[e]),this.require(t);if(!n)return new Error("define模块".concat(e,"未找到"))}},{key:"checkCycle",value:function(e,t){var n=this,r=l.globDeps[e].deps;return r.some(function(e){return e===t||(l.globDeps[e]&&1===l.globDeps[e].status?n.checkCycle(r,t):void 0)})}},{key:"onScriptLoad",value:function(e){if("load"===e.type||t.test((e.currentTarget||e.srcElement).readyState)){var n=function(e){var t=e.currentTarget||e.srcElement;return c(t,l.onScriptLoad,"load"),c(t,l.onScriptError,"error"),{node:t,name:t&&t.getAttribute("data-requiremodule")}}(e);l.completeLoad(n.name)}}},{key:"onScriptError",value:function(){}}]),e}()),f=function(){function e(t){_classCallCheck(this,e);var n={name:"",src:"",deps:[],beDeps:[],depsCount:0,status:1,cb:function(){},result:void 0,error:function(){}};t&&Object.assign(n,t),Object.assign(this,n)}return _createClass(e,[{key:"init",value:function(){return void 0,this.depsCount=this.deps.length,this.onStatus(),this.analyzeDep(),0===this.deps.length&&(this.status=2),this.deps.length>0&&this.loadDepModule(),this}},{key:"loadDepModule",value:function(){var e=this;this.deps.forEach(function(t){if(l.depMap[t])l.depMap[t].push(e.name);else if(l.globDeps[t]){var n=l.globDeps[t];if(2===n.status)n.beDeps.push(e.name),e.depsCount--;else if(1===n.status){new RegExp(l.name).test(e.name)?n.beDeps.unshift(e.name):n.beDeps.push(e.name),l.checkCycle(t,e.name)&&(void 0,e.depsCount--)}}else l.depMap[t]=[e.name],void 0,e.fetch(t)})}},{key:"fetch",value:function(e){var t=p.createNode();t.src=e,t.setAttribute("data-requirecontext",l.name),t.setAttribute("data-requiremodule",e),t.addEventListener("load",l.onScriptLoad,!1),t.addEventListener("error",l.onScriptError,!1),o.appendChild(t)}},{key:"analyzeDep",value:function(){var e=this.depsCount;Object.defineProperties(this,{depsCount:{configurable:!0,get:function(){return e},set:function(t){0===(e=t)&&1===this.status&&(this.status=2)}}})}},{key:"onStatus",value:function(){var e=this.status;Object.defineProperties(this,{status:{get:function(){return e},set:function(t){if(e=t,2===t){var n=this.deps.map(function(e){var t=l.globDeps[e];if(t)return t.result});this.result=this.exec.apply(this,_toConsumableArray(n)),void 0,u(this.beDeps,function(e){l.globDeps[e].depsCount--})}if(3===t)return new Error("模块".concat(this.name,"加载出错"))}}})}},{key:"exec",value:function(){if("function"==typeof this.cb)return this.cb.apply(this,arguments)}}]),e}(),p=e.require=function e(t,n){return"string"==typeof t?l.require(t):("function"==typeof t&&(n=t,t=[]),void 0,t=t.map(function(e){return a(l.config.baseUrl,e)}),l.require({deps:t,cb:n}),e)};p.config=function(e){if(e&&!i(e)&&"string"!=typeof deps)return l.configure(e)},p.load=function(){},p.nextTick=setTimeout?function(e){return setTimeout(e,4)}:function(e){return e()},p.createNode=function(e,t,n){var r=document.createElement("script");return r.type="text/javascript",r.charset="utf-8",r.async=!0,r};e.define=function(e,t,n){"string"!=typeof e&&(n=t,t=e,e=null),i(t)||(n=t,t=[]),t=t.map(function(e){return a(l.config.baseUrl,e)}),l.depQueue.push({name:e,deps:t,cb:n})},p.nextTick(function(){u(document.getElementsByTagName("script"),function(e){var t=e.getAttribute("data-main");if(t){var n=t;return l.config.baseUrl||(l.config.baseUrl=s("",n)),l.require({deps:[n]}),!0}})})}(window||void 0);