{"version":3,"sources":["funM.js"],"names":["global","context","config","cfg","isArray","it","Object","prototype","toString","call","scripts","document","getElementsByName","eachReverse","ary","func","i","length","Module","data","defaultData","id","name","src","dep","status","cb","error","assign","firstModule","require","deps","fun","concat","req","script","dataMain","getAttribute","mainScript","baseUrl","split","pop","subPath","join"],"mappings":"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","sourcesContent":["\n(global => {\n\n  let context = {\n    config: {},\n  }\n  let cfg = context.config\n\n  function isArray (it) {\n    return Object.prototype.toString.call(it) === '[object Array]'\n  }\n  function scripts () {\n    return document.getElementsByName('script')\n  }\n  function eachReverse (ary, func) {\n    if (ary) {\n      for (let i = ary.length - 1; i > -1; i -= 1) {\n        if (ary[i] && func(ary[i], i, ary)) {\n          break\n        }\n      }\n    }\n  }\n\n  class Module {\n    constructor (data) {\n      const defaultData = {\n        id: '', // 模块id\n        name: '', // 模块名称\n        src: '', // 模块路径\n        dep: [], // 模块的依赖\n        status: '', // 模块的状态\n        cb: () => {},\n        error: () => {},\n      }\n      if (data) Object.assign(defaultData, data)\n      Object.assign(this, defaultData)\n    }\n    init () {\n      // 初始化\n    }\n    fetch () {}\n    analyzeDep () {}\n    exec () {}\n  }\n\n  // 创建首个Module, 入口即为该Module的依赖\n  let firstModule = new Module()\n\n  const require = (deps, fun) => {\n    if (isArray(deps)) {\n      firstModule.dep.concat(deps)\n    }\n  }\n  const req = global.require = require\n\n  req.config = config => {\n    if (config) {\n      if (!isArray(config) && typeof deps !== 'string') {\n        // 配置\n        cfg = config\n      }\n    }\n  }\n\n  // Figure out baseUrl. Get it from the script tag with require.js in it.\n  eachReverse(scripts(), script => {\n\n    let src = []\n    const dataMain = script.getAttribute('data-main')\n    if (dataMain) {\n      let mainScript = dataMain\n\n      // 若没有配置baseUrl，则从dataMain中获取\n      if (!cfg.baseUrl) {\n        src = mainScript.split('/')\n        mainScript = src.pop()\n        const subPath = src.length ? src.join('/') + '/' : './'\n        cfg.baseUrl = subPath\n      }\n\n      // Put the data-main script in the files to load.\n      cfg.deps = cfg.deps ? cfg.deps.concat(mainScript) : [mainScript]\n\n      return true\n    }\n  })\n\n})(this)\n"],"file":"funM.js"}